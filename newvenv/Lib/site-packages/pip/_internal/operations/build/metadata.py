"""Metadata generation logic for source distributions.
"""

import os

<<<<<<< HEAD
from pip._vendor.pep517.wrappers import Pep517HookCaller

from pip._internal.build_env import BuildEnvironment
from pip._internal.exceptions import (
    InstallationSubprocessError,
    MetadataGenerationFailed,
)
from pip._internal.utils.subprocess import runner_with_spinner_message
from pip._internal.utils.temp_dir import TempDirectory


def generate_metadata(
    build_env: BuildEnvironment, backend: Pep517HookCaller, details: str
) -> str:
=======
from pip._internal.utils.subprocess import runner_with_spinner_message
from pip._internal.utils.temp_dir import TempDirectory
from pip._internal.utils.typing import MYPY_CHECK_RUNNING

if MYPY_CHECK_RUNNING:
    from pip._internal.build_env import BuildEnvironment
    from pip._vendor.pep517.wrappers import Pep517HookCaller


def generate_metadata(build_env, backend):
    # type: (BuildEnvironment, Pep517HookCaller) -> str
>>>>>>> 8de800139f334d7624e4f4a6fb35897a220f3b13
    """Generate metadata using mechanisms described in PEP 517.

    Returns the generated metadata directory.
    """
<<<<<<< HEAD
    metadata_tmpdir = TempDirectory(kind="modern-metadata", globally_managed=True)
=======
    metadata_tmpdir = TempDirectory(
        kind="modern-metadata", globally_managed=True
    )
>>>>>>> 8de800139f334d7624e4f4a6fb35897a220f3b13

    metadata_dir = metadata_tmpdir.path

    with build_env:
        # Note that Pep517HookCaller implements a fallback for
        # prepare_metadata_for_build_wheel, so we don't have to
        # consider the possibility that this hook doesn't exist.
<<<<<<< HEAD
        runner = runner_with_spinner_message("Preparing metadata (pyproject.toml)")
        with backend.subprocess_runner(runner):
            try:
                distinfo_dir = backend.prepare_metadata_for_build_wheel(metadata_dir)
            except InstallationSubprocessError as error:
                raise MetadataGenerationFailed(package_details=details) from error
=======
        runner = runner_with_spinner_message("Preparing wheel metadata")
        with backend.subprocess_runner(runner):
            distinfo_dir = backend.prepare_metadata_for_build_wheel(
                metadata_dir
            )
>>>>>>> 8de800139f334d7624e4f4a6fb35897a220f3b13

    return os.path.join(metadata_dir, distinfo_dir)
